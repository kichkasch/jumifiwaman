<script type="text/javascript">
    $(document).ready(function() {
        $("#accordionDevices").accordion({
            autoHeight: false,
            collapsible: true,
            active: false,
        });        
        $("#accordionFirmware").accordion({
            autoHeight: false,
            collapsible: true,
            active: false,
        });        

        /*
        $("#myDevicesTable tbody").click(function(event) {
            $(myDevTable.fnSettings().aoData).each(function (){
                $(this.nTr).removeClass('row_selected');
            });
            $(event.target.parentNode).addClass('row_selected');
        });
        $('#deleteDevRow').click( function() {
            var anSelected = fnGetSelected( myDevTable);
            myDevTable.fnDeleteRow( anSelected[0] );    
        } ); */
        
        var myDevTable;
        myDevTable = $('#myDevicesTable').dataTable( {
            "sPaginationType": "full_numbers",
            "bJQueryUI": true,
            "bProcessing": true,
            "bServerSide": true,
            "sAjaxSource": "/getMyDevices",
            "aoColumns": [
                    { "bSearchable": true},
                    null,
                    { "bSortable": false },
                    { "bSortable": false },
                    null,
                    null
                    ],
            "sSearch": false    
        });
        $('#myDevicesTable').click(function(event) {
            $(myDevTable.fnSettings().aoData).each(function (){
                $(this.nTr).removeClass('row_selected');    // deselect before selected
            });
            $(event.target.parentNode).addClass('row_selected');
        });
        
        $('#devicesTable').dataTable( {
            "sPaginationType": "full_numbers",
            "bJQueryUI": true,
            "bProcessing": true,
            "bServerSide": true,
            "sAjaxSource": "/getDevices",
            "aoColumns": [
                    { "bSearchable": true},
                    null,
                    { "bSortable": false },
                    { "bSortable": false }
                    ],
            "sSearch": false    
        });

        $('#deviceGroupsTable').dataTable( {
            "sPaginationType": "full_numbers",
            "bJQueryUI": true,
        });

        $('#manufactorersTable').dataTable( {
            "sPaginationType": "full_numbers",
            "bJQueryUI": true,
        });
        
        var myFirmwareTable;
        myFirmwareTable = $('#firmwareTable').dataTable( {
            "sPaginationType": "full_numbers",
            "bJQueryUI": true,
            "bProcessing": true,
            "bServerSide": true,
            "sAjaxSource": "/getFirmwareGroups"
        });
        $("#firmwareTable tbody").click(function(event) {
            $(myFirmwareTable.fnSettings().aoData).each(function (){
                $(this.nTr).removeClass('row_selected');    // deselect before selected
            });
            $(event.target.parentNode).addClass('row_selected');
        });
          $("#fwGroupDetails").click(function() {
            var anSelected1 = fnGetSelected(myFirmwareTable);
            var nTds = $('td', anSelected1);
            $.get("/details/fwGroupByName", {name: $(nTds[0]).text()}, function(data){
                var vals = data.split("\n");
                $("#fwDetailsName").text(vals[0]);
                $("#fwDetailsHP").text(vals[1]);
                $("#fwDetailsNotes").text(vals[2]);
                $("#fwDetailsStatus").text(vals[3]);
                $("#fwDetailsSource").text(vals[4]);
            }); 
            
            $('#tableFirmwareHistory > tbody:last').empty();
            $('#tableFirmwareHistory > tbody:last').append('<tr><th width="50%">Release date</th><th width="50%">Version number</th></tr>');
            $.get("/getAllReleasesForFirmwareGroup", {groupName: $(nTds[0]).text()}, function(data){
                    $('#tableFirmwareHistory > tbody:last').append(data);
            });
            
            $("#dialog-fwDetails").dialog({
                width: 400,
                modal: true,
                draggable: false ,
                closeText: 'show',
                autoOpen: true,
                buttons: { "Close": function() { $(this).dialog("close"); } },
            });
          });
          
        $('#fwGroupUpdatecheck').click(function () {
            var anSelected1 = fnGetSelected(myFirmwareTable);
            var nTds = $('td', anSelected1);
            $.get("/details/fwGroupByName", {name: $(nTds[0]).text()}, function(data){
                var vals = data.split("\n");
                $("#fwManualFWName").text(vals[0]);
                $("#fwManualURL").text(vals[1]);
            });    
            $.get("/getLatestReleaseForFirmwareGroup", {groupName: $(nTds[0]).text()}, function(data){
                var vals = data.split("\n");
                $("#fwManualLatestNumber").text(vals[0]);
                $("#fwManualLatestDate").text(vals[1]);            
            });
            $('#dialogFWManualUpdateCheck').dialog({
                autoOpen: true,
                width: 400,
                modal: true,
                draggable: false ,
                buttons: {
                    'Add this release to Firmware Group': function() {
                        $.post("/newRelease", {
                            fwReleaseNumber: $("#fwManualReleaseNumber").val(), 
                            fwReleaseDate:$("#fwManualReleaseDate").val(), 
                            fwGroupForRelease: $(nTds[0]).text(), 
                            fwReleaseDirectLink: $("#fwManualReleaseDirectLink").val()
                            });
                        $('#firmwareTable').dataTable().fnClearTable(0);
                        $('#firmwareTable').dataTable().fnDraw();                        
                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                }
            });
        });
          


        $('#fwSourcesGroupsTable').dataTable( {
            "sPaginationType": "full_numbers",
            "bJQueryUI": true,
        });

        $('#fwStatusTable').dataTable( {
            "sPaginationType": "full_numbers",
            "bJQueryUI": true,
        });
        
        $('#myDevChangeFW').click(function() {
            var anSelected2 = fnGetSelected(myDevTable);
            var nTds2 = $('td', anSelected2);
            var fwgChangeDevName = $(nTds2[0]).text();
            $("#myDevChangeFWG").text(fwgChangeDevName);
            $('#dialogMyDevicesChangeFWG').dialog({
                autoOpen: true,
                width: 350,
                modal: true,
                draggable: false ,
                buttons: {
                    'Apply this firmware group': function() {
                            $.post("/applyFWGToMyDevice", {
                            deviceName: fwgChangeDevName,
                            fwgName: $("#myDeviceChangeFWG").val()
                            });
                        $('#myDevicesTable').dataTable().fnClearTable( 0 );
                        $('#myDevicesTable').dataTable().fnDraw();
                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                } //close
            }); // dialog
            $('#myDeviceChangeFWG').empty();            
            $.get("/getFWGsForDevice", {}, function(data){
                $('#myDeviceChangeFWG').append(data);
            });            
            
        });  //click
        
        
    } );
    
	$(function() {
          $("#buttonHelp").click(function() {
            $("#dialog-help").dialog({
                width: 800,
                modal: true,
                draggable: false ,
                closeText: 'show',
                autoOpen: true,
                buttons: { "Close": function() { $(this).dialog("close"); } },
            });
          });
                
        $("#buttonDetailToggler").click(function() {
            $("#deviceDetailToggler").toggle("blind",{},500);
            return false;
        });
        
        $("#buttonDetailManToggler").click(function() {
            $("#manDetailToggler").toggle("blind",{},500);
            return false;
        });
                
        $('#buttonMan').click(function() {
            $('#dialogMan').dialog({
                autoOpen: true,
                width: 350,
                modal: true,
                draggable: false ,
                buttons: {
                    'Create this Manufacturer': function() {
                        $('#manufactorersTable').dataTable().fnAddData( [$("#manName").val(),$("#manWebsite").val() ] );
                        $('#devManName').append("<option>" + $("#manName").val() + "</option>");
                        $.post("/newManufactorer",{ 
                            manName: $("#manName").val(), manWebsite: $("#manWebsite").val()});
                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                }
            });
        });

        $('#buttonDeviceGroup').click(function() {
            $('#dialogDevGroup').dialog({
                autoOpen: true,
                width: 350,
                modal: true,
                draggable: false ,
                buttons: {
                    'Create this Device Group': function() {
                        $('#deviceGroupsTable').dataTable().fnAddData( [$("#groupName").val()] );
                        $('#devDevGroup').append("<option>" + $("#groupName").val() + "</option>");
                        $.post("/newDeviceGroup",{ groupName: $("#groupName").val()});

                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                }
            });
        });
   
        $('#buttonDevice').click(function() {
            $('#dialogDevice').dialog({
                autoOpen: true,
                width: 350,
                modal: true,
                draggable: false ,
                buttons: {
                    'Create this Device': function() {
                            $.post("/newDevice", {
                            deviceName: $("#deviceName").val(), 
                            deviceID: $("#deviceId").val(), 
                            deviceGroup:$("#devDevGroup").val(),
                            manufactorer:$("#devManName").val() });
                        $('#devicesTable').dataTable().fnClearTable( 0 );
                        $('#devicesTable').dataTable().fnDraw();
                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                }
            });
        });
        
        $('#fwGroupAdd').click(function() {
            $('#dialogFWGroup').dialog({
                autoOpen: true,
                width: 350,
                modal: true,
                draggable: false ,
                buttons: {
                    'Create this Firmware Group': function() {
                        $.post("/newFirmwareGroup", {
                            fwGroupName: $("#fwGroupName").val(), 
                            fwGroupHomepage:$("#fwGroupHomepage").val(), 
                            fwGroupNotes: $("#fwGroupNotes").val(), 
                            fwGroupStatus: $("#fwStatus").val(), 
                            fwGroupSource:$("#fwSource").val()
                            });
                        $('#firmwareTable').dataTable().fnClearTable( 0 );
                        $('#firmwareTable').dataTable().fnDraw();
                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                }
            });
        });        
        
        $('#buttonFWSourceGroup').click(function() {
            $('#dialogFWSourceGroup').dialog({
                autoOpen: true,
                width: 350,
                modal: true,
                draggable: false ,
                buttons: {
                    'Create this Firmware Source Group': function() {
                        $('#fwSourcesGroupsTable').dataTable().fnAddData( [$("#fwSourceGroupName").val()] );
                        $('#fwSource').append("<option>" + $("#fwSourceGroupName").val() + "</option>");
                        $.post("/newFirmwareSource",{ fwSourceName: $("#fwSourceGroupName").val()});
                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                }
            });
        });        

        $('#buttonFWStatus').click(function() {
            $('#dialogFWStatus').dialog({
                autoOpen: true,
                width: 350,
                modal: true,
                draggable: false ,
                buttons: {
                    'Create this Development Status': function() {
                        $('#fwStatusTable').dataTable().fnAddData( [$("#fwStatusName").val()] );
                        $('#fwStatus').append("<option>" + $("#fwStatusName").val() + "</option>");                        
                        $.post("/newFirmwareStatus",{ fwStatusName: $("#fwStatusName").val()});
                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                }
            });
        });


        $('#myDevNew').click(function() {
            $('#dialogMyDevicesNew').dialog({
                autoOpen: true,
                width: 350,
                modal: true,
                draggable: false ,
                buttons: {
                    'Add this Device': function() {
                            $.post("/addToMyDevices", {
                            deviceName: $("#myDeviceNewDevice").val(),
                            fwgName: $("#myDeviceNewDeviceFWG").val()
                            });
                        $('#myDevicesTable').dataTable().fnClearTable( 0 );
                        $('#myDevicesTable').dataTable().fnDraw();
                        $(this).dialog('close');
                    },
                    Cancel: function() {
                        $(this).dialog('close');
                    }
                },
                close: function() {
                    allFields.val('').removeClass('ui-state-error');
                }
                                
            });
            $('#myDeviceNewDeviceFWG').empty();            
            $.get("/getFWGsForDevice", {}, function(data){
                $('#myDeviceNewDeviceFWG').append(data);
            });            
        });
            
        
        $('#myDeviceGroup').change(function() {
            $('#myDeviceNewDevice').empty();            
            $.get("/getDevicesForGroup", {deviceGroup: $("#myDeviceGroup").val()}, function(data){
                $('#myDeviceNewDevice').append(data);
            });                            
        });
        
    });

    $('#dialog-help').hide();
    $('#date').datepicker();    
    $("#dialog-help").dialog("destroy");
    $("#deviceDetailToggler").hide();
    $("#manDetailToggler").hide();
    $("#dialogMan").hide();
    $("#dialogDevGroup").hide();
    $("#dialogDevice").hide();
    $('#dialogFWSourceGroup').hide();
    $('#dialogFWStatus').hide();
    $('#dialogFWGroup').hide();
    $("#dialog-fwDetails").hide();
    $('#dialogFWManualUpdateCheck').hide();
    $("#dialogMyDevicesNew").hide();
    $("#dialogMyDevicesChangeFWG").hide(); 
    $("#tabs").tabs();

	</script>

